"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),Deferred=require("./../utils/deferred.js"),api=require("./../utils/api.js"),color=require("./../utils/color.js"),DEFAULT_SEARCH_PARAM={page:1},Index=function(e){function t(){var e,r,a,n;_classCallCheck(this,t);for(var o=arguments.length,s=Array(o),i=0;i<o;i++)s[i]=arguments[i];return r=a=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),a.config={navigationBarTitleText:"我的报价单",enablePullDownRefresh:!0,backgroundTextStyle:"dark",usingComponents:{"i-tag":"../iview/tag/index","i-divider":"../iview/divider/index"}},a.components={},a.data={searchParam:Object.assign({},DEFAULT_SEARCH_PARAM),loading:!1,hasNext:!0,sheetList:[]},a.methods={showDetail:function(e){wx.navigateTo({url:"food-quote-sheet-detail?foodQuoteSheetId="+e})}},a.events={},n=r,_possibleConstructorReturn(a,n)}return _inherits(t,e),_createClass(t,[{key:"computed",value:function(){}},{key:"resetSearchParam",value:function(){Object.assign(this.searchParam,DEFAULT_SEARCH_PARAM),this.hasNext=!0}},{key:"onPullDownRefresh",value:function(){this.resetSearchParam(),this.search().always(function(){wx.stopPullDownRefresh()})}},{key:"onReachBottom",value:function(){this.hasNext&&(this.searchParam.page++,this.search(!0))}},{key:"search",value:function(e,t){var r=this;return wx.showLoading({title:"加载中"}),api.foodQuoteSheet.search(this.searchParam).done(function(t){r.handleSheetList(t.data.results),r.sheetList=e?r.sheetList.concat(t.data.results):t.data.results;var a=t.data;r.hasNext=a.hasNext,r.$apply()}).always(function(){wx.hideLoading(),t&&t()})}},{key:"handleSheetList",value:function(e){var t=this;e.forEach(function(e){e.statusColor=t.getStatusStyle(e.status),e.publishStatusColor=t.getPublishStatusStyle(e.publishStatus)})}},{key:"getStatusStyle",value:function(e){switch(e){case"WAIT_VERIFY":return color.warning;case"VERIFY_SUCCESS":return color.success;case"VERIFY_FAIL":return color.danger}}},{key:"getPublishStatusStyle",value:function(e){switch(e){case"WAIT":return"yellow";case"SUCCESS":return"green";case"FAIL":return"red"}}},{key:"onLoad",value:function(){var e=this;Deferred.when(this.search()).always(function(){e.loaded=!0})}}]),t}(_wepy2.default.page);exports.default=Index;