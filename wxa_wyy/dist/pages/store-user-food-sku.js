"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),Deferred=require("./../utils/deferred.js"),api=require("./../utils/api.js"),Index=function(e){function t(){var e,i,o,n;_classCallCheck(this,t);for(var a=arguments.length,u=Array(a),r=0;r<a;r++)u[r]=arguments[r];return i=o=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(u))),o.config={navigationBarTitleText:"发布规格",enablePullDownRefresh:!0,backgroundTextStyle:"dark",backgroundColor:"#efeff4",usingComponents:{"i-radio-group":"../iview/radio-group/index","i-radio":"../iview/radio/index","i-checkbox-group":"../iview/checkbox-group/index","i-checkbox":"../iview/checkbox/index","i-panel":"../iview/panel/index","i-button":"../iview/button/index","i-tag":"../iview/tag/index"}},o.components={},o.watch={specialSkuIdList:function(e){var t=this;this.specialSkuNameList=e.map(function(e){return t.foodSkuMap[e].spec})},eleSkuId:function(e){e&&(this.eleSkuName=this.foodSkuMap[e].spec)}},o.data={loading:!1,specialSkuIdList:[],specialSkuNameList:[],eleSkuId:"",eleSkuName:"",foodSkuList:[],id:0,foodId:0,foodSkuMap:{},foodName:""},o.methods={handleSpecialSkuChange:function(e){var t=e.detail,i=void 0===t?{}:t,o=this.specialSkuNameList.indexOf(i.value);-1===o?this.specialSkuNameList.push(i.value):this.specialSkuNameList.splice(o,1),this.$apply()},handleEleSkuChange:function(e){var t=e.detail,i=void 0===t?{}:t;this.eleSkuName=i.value,this.$apply()},save:function(){var e=this;wx.showModal({title:"提示",content:"确认发布所选规格吗？",success:function(t){if(t.confirm){var i=e.foodSkuList.filter(function(t){return e.specialSkuNameList.indexOf(t.spec)>-1}).map(function(e){return e.skuId}),o=e.foodSkuList.filter(function(t){return t.spec===e.eleSkuName}).map(function(e){return e.skuId});api.storeUserFood.specialSku({id:e.id,specialSkuIdList:i,eleSkuId:o}).done(function(t){t.data&&(wx.showToast({title:"上架成功",icon:"success",duration:500}),e.sale())})}else t.cancel}})}},o.events={},n=i,_possibleConstructorReturn(o,n)}return _inherits(t,e),_createClass(t,[{key:"onPullDownRefresh",value:function(){this.loadData()}},{key:"sale",value:function(){wx.showLoading(),api.storeUserFood.sale({foodId:this.foodId}).done(function(e){e.data&&(wx.showToast({title:"发布成功",icon:"success",duration:500}),wx.navigateBack())}).always(function(){wx.hideLoading()})}},{key:"loadData",value:function(){var e=this;return api.storeUserFood.sku({id:this.id}).done(function(t){var i=t.data;e.foodId=i.foodId,e.foodName=i.foodName,e.specialSkuIdList=i.specialSkuIdList,e.foodSkuList=i.foodSkuList,e.foodSkuList.forEach(function(t){e.foodSkuMap[t.skuId]=t}),e.eleSkuId=i.eleSkuId,e.$apply()})}},{key:"onLoad",value:function(e){var t=this;this.id=+e.id,Deferred.when(this.loadData()).always(function(){t.loaded=!0})}}]),t}(_wepy2.default.page);Page(require("./../npm/wepy/lib/wepy.js").default.$createPage(Index,"pages/store-user-food-sku"));